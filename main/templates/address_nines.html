{% extends "base.html" %}
{% load custom_filters %}

{% block style %}

.glyphicon
{
    cursor: pointer;
}
.input-group
{
    width: 120px;
}

{% endblock %}

{% block formstart %}
    <form action="" method="post" accept-charset="utf-8" role="form" id="form">
    {% csrf_token %}
{% endblock %} 

{% block content %}

{% if performances %}

<h2>
    Marks for {{ module }}
</h2>

<table id ="sortable_table" class="table table-striped table-sortable">
    <thead>
        <tr>
            <th>
                Student
            </th>
            {% for assessment in module.all_assessment_titles %}
                <th>
                    {{ assessment.0 }}{% if assessment.1 %} ({{ assessment.1 }} %){% endif %}
                </th>
            {% endfor %}
            <th>
                Module Mark
            </th>
        </tr>
    </thead>
    <tbody>
    {% for performance in performances %}
        <tr>
            <td>
                <label>{{ performance.student.short_name }}</label>
            </td>
            {% for result in performance.all_results_as_slug_tpls %}
            <td>
                <div class="input-group">
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-minus-sign" id="{{ performance.student.student_id }}_minus_{{ result.0 }}"></span>
                    </span>
                    <input class="form-control mark_field {{ performance.student.student_id }}_input" id="{{ performance.student.student_id }}_1" name="{{ performance.student.student_id }}_{{ result.0 }}" value="{{ result.1 }}">
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-plus-sign" id="{{ performance.student.student_id }}_plus_{{ result.0 }}"></span>
                    </span>
                </div>
                (original: {{ result.1 }})
                <span class="help-block" id="{{ performance.student.student_id }}_error_{{ result.0 }}"></span>
            </td>
            {% endfor %}
            <td id="average">
                {{ performance.average }}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<input type="submit" value="Save Marks" class="btn btn-default" align=right>

{% else %}

<h1>Congratulations - there are no averages ending with a 9!</h2>

<p>It looks like you are ready for the exam boards!</p>

<a href="{{ module.get_absolute_url }}" class="button btn btn-default">Back to the Module</a>

{% endif %}

{% endblock %}

{% block formend %}
</form>
{% endblock %}

{% block scripts %}

<script type="text/javascript">

$(document).ready(function () {


    {% comment %}
    $('.glyphicon').click(function() {
        var this_id = $(this).attr("id");
        var this_list = this_id.split("_");
        var student_id = this_list[0];
        element_to_change = '#' + student_id + '_' + this_list[2];
        current = parseInt($(element_to_change).val());
        if (this_list[1] == 'plus') {
            new_value = current + 1;
            if (new_value > 100) {
                new_value = 100;
            };
        }
        else {
            new_value = current - 1;
            if (new_value < 0) {
                new_value = 0;
            };
        };
        $(element_to_change).val(new_value);
        calculate_average(student_id);
    });

    $('.form-control').change(function () {
        var student_id = $(this).attr('id').split('_').shift()
        if (validate(student_id)) {
            calculate_average(student_id);
        };
    });
    {% endcomment %}

}); 
</script>

{% endblock %}
