{% extends "base.html" %}
{% block content %}

<div class="jumbotron">
    <h1>{{ module }}</h1>

    <p>
        <table class="table">
            <tr>
                <td><strong>Code</strong></td>
                <td>{{module.code}}</td>
                <td><strong>Year</strong></td>
                <td>{{module.year}}/{{module.year|add:"1"}}</td>
            </tr>
            <tr>
                <td><strong>Number of Students</strong></td>
                <td>{{ module.student_set.count }}</td>
                <td><strong>Sessions so far<strong></td>
                <td>{{ module.sessions_recorded }}</td>
        </table>
    </p>  
    {% if adminorinstructor %}
        <p>
            <small><a href=# class="delete">Delete this module</a></small>
        </p>
    {% endif %}
     <p align="right">
     <a class="btn btn-default" id="edit" href="{{ module.get_edit_url }}">
            Edit
        </a>
    </p>
</div>

<div class="btn-group" id="module_control_buttons">
    <div class="btn-group dropdown">
        <a class = "btn btn-default dropdown-toggle" data-toggle="dropdown">Seminar Groups / Attendance <span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
            <li><a href="{{ module.get_seminar_groups_url }}">Assign Seminar Groups</a></li>
            {% for item in seminar_group_links %}
                {% if item.0 == 'all' %}
                    <li><a href="{{ item.1 }}">Attendance for all groups</a></li>
                {% else %}
                    <li><a href="{{ item.1 }}">Attendance for Seminar Group {{ item.0 }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    <div class="btn-group dropdown">
        <a class = "btn btn-default dropdown-toggle" data-toggle="dropdown">Assessment <span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
            <li><a href="{{ module.get_assessment_url }}">Set assessments for the module</a></li>
        </ul>
    </div>
    <a class="btn btn-default" id="add_students_to_module" href="{{ module.get_add_students_url }}">
        Add Student(s)
    </a>
</div>

<br><br>

{% if module.all_assessment_titles|length == 0 %}
<p class="bg-warning">You need to <a href="{{ module.get_assessment_url }}">set some assessments for this module</a></p>
{% endif %}


{% if performances %}

<table id ="sortable_table" class="table table-striped table-sortable">
    <thead>
        <tr>
            <th>
                Seminar Group
            </th>
            <th>
                Student
            </th>
            <th>
                LSP
            </th>
            <th>
                Attendance
            </th>
            {% for assessment in module.all_assessment_titles %}
                <th>
                    {{ assessment.0 }}{% if assessment.1 %} ({{ assessment.1 }} %){% endif %}
                </th>
            {% endfor %}
            <th>
                Module Mark
            </th>
            <th>
                &nbsp;
            </th>
        </tr>
    </thead>
    <tbody>
        {% for performance in performances %}
            <tr>
                <td>
                    {{ performance.seminar_group|default_if_none:"" }}
                </td>
                <td>
                    <a href="{{ performance.student.get_absolute_url }}">{{ performance.student.short_name }}</a>
                </td>
                <td>
                    {% if performance.student.lsp %}<span class="glyphicon glyphicon-warning-sign"></span>{% endif %}
                </td>
                <td>
                    {{ performance.count_attendance }}
                </td>
                {% for assessment_result in performance.all_assessment_results_as_strings %}
                    <td>
                        {{ assessment_result|default_if_none:"" }}
                    </td>
                {% endfor %}
                <td>
                    {{ performance.average|default_if_none:"" }}
                </td>
                <td>
                    <a href="#" class="remove"><span class="glyphicon glyphicon-remove" id="{{ performance.student.student_id }}"></span></a>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}

<p class="bg-warning">You need to <a href="{{ module.get_add_students_url }}">add students</a> to this module.</p>

{% endif %}

{% endblock %}

{% block loadscripts %}
<script src="{{ STATIC_URL }}js/bootbox.min.js"></script>
{% endblock %}

{% block scripts %}

<script type="text/javascript">

    $(document).ready(function(){

        $(document).on("click", ".remove", function(e) {
            bootbox.confirm("Are you sure you want to remove this student from the module and delete all marks the students might have in this module? If the student is just temporary absent, it is better to mark them inactive.", function(confirm) {
                if (confirm)
                {
                var student_id = e.target.id;
                var remove = "{{ module.get_blank_remove_student_url }}" + student_id;
                window.location.replace(remove);
                }
            });
        });

    });

</script>

{% endblock %}
